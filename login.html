<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>๋ก๊ทธ์ธ | ๊ฝ๋ณด๋ผ๊ฐ๋</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#2d5f3f"
                    }
                },
            },
        }
    </script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
    </style>
</head>
<body class="bg-gray-50">
<!-- ํค๋ -->
<header class="bg-white border-b">
<div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
<div class="flex items-center gap-3">
<span class="text-2xl">๐ธ</span>
<h2 class="text-2xl font-bold text-primary"><a href="flower.html">๊ฝ๋ณด๋ผ๊ฐ๋</a></h2>
</div>
<a href="flower.html" class="text-sm text-gray-600 hover:text-primary">โ ๋ฉ์ธ์ผ๋ก</a>
</div>
</header>

<main class="min-h-screen flex items-center justify-center py-12 px-4">
<div class="max-w-md w-full">
<!-- ํญ -->
<div class="bg-white rounded-t-2xl shadow-lg border-t border-x overflow-hidden">
<div class="flex">
<button id="loginTab" onclick="showLogin()" class="flex-1 py-4 font-bold text-primary bg-primary/5 border-b-2 border-primary transition-all">
๋ก๊ทธ์ธ
</button>
<button id="signupTab" onclick="showSignup()" class="flex-1 py-4 font-bold text-gray-400 hover:text-gray-600 border-b border-gray-200 transition-all">
ํ์๊ฐ์
</button>
</div>
</div>

<!-- ๋ก๊ทธ์ธ ํผ -->
<div id="loginForm" class="bg-white rounded-b-2xl shadow-lg border-b border-x p-8">
<h2 class="text-2xl font-bold mb-6 text-center">๊ฝ๋ณด๋ผ๊ฐ๋์ ์ค์ ๊ฒ์ ํ์ํฉ๋๋ค ๐ธ</h2>

<form onsubmit="handleLogin(event)" class="space-y-4">
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">์ด๋ฉ์ผ</label>
<input 
    type="email" 
    id="loginEmail" 
    required 
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="your@email.com"
/>
</div>

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">๋น๋ฐ๋ฒํธ</label>
<input 
    type="password" 
    id="loginPassword" 
    required 
    minlength="6"
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="6์ ์ด์"
/>
</div>

<button 
    type="submit" 
    class="w-full py-4 bg-primary text-white font-bold rounded-xl hover:bg-primary/90 transition-all shadow-lg hover:shadow-xl mt-6"
>
๋ก๊ทธ์ธํ๊ธฐ
</button>
</form>

<div id="loginMessage" class="mt-4 p-3 rounded-lg hidden"></div>
</div>

<!-- ํ์๊ฐ์ ํผ -->
<div id="signupForm" class="bg-white rounded-b-2xl shadow-lg border-b border-x p-8 hidden">
<h2 class="text-2xl font-bold mb-6 text-center">์๋ก์ด ์์ ๐ฑ</h2>

<form onsubmit="handleSignup(event)" class="space-y-4">
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">์ด๋ฆ</label>
<input 
    type="text" 
    id="signupName" 
    required 
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="ํ๊ธธ๋"
/>
</div>

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">์ด๋ฉ์ผ</label>
<input 
    type="email" 
    id="signupEmail" 
    required 
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="your@email.com"
/>
</div>

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">์ํ๋ฒํธ</label>
<input 
    type="tel" 
    id="signupPhone" 
    required 
    pattern="[0-9]{10,11}"
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="01012345678"
/>
</div>

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">๋น๋ฐ๋ฒํธ</label>
<input 
    type="password" 
    id="signupPassword" 
    required 
    minlength="6"
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="6์ ์ด์"
/>
</div>

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">๋น๋ฐ๋ฒํธ ํ์ธ</label>
<input 
    type="password" 
    id="signupPasswordConfirm" 
    required 
    minlength="6"
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="๋น๋ฐ๋ฒํธ ์ฌ์๋ฅ"
/>
</div>

<button 
    type="submit" 
    class="w-full py-4 bg-primary text-white font-bold rounded-xl hover:bg-primary/90 transition-all shadow-lg hover:shadow-xl mt-6"
>
ํ์๊ฐ์ํ๊ธฐ
</button>
</form>

<div id="signupMessage" class="mt-4 p-3 rounded-lg hidden"></div>
</div>

<!-- ํ์คํธ ๊ณ์ ์๋ด -->
<div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-xl">
<p class="text-sm text-blue-800 text-center">
<span class="font-bold">๐ก ํ์คํธ:</span> ์๋ฌด ์ด๋ฉ์ผ๋ก ํ์๊ฐ์ ํ ํ์ธ ์ด๋ฉ์ผ ๋ฐ์ผ์ธ์!
</p>
</div>
</div>
</main>

<!-- Supabase Client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase-config.js"></script>

<script>
// ํญ ์ํ
function showLogin() {
    document.getElementById('loginForm').classList.remove('hidden');
    document.getElementById('signupForm').classList.add('hidden');
    document.getElementById('loginTab').classList.add('text-primary', 'bg-primary/5', 'border-b-2', 'border-primary');
    document.getElementById('loginTab').classList.remove('text-gray-400', 'border-gray-200');
    document.getElementById('signupTab').classList.remove('text-primary', 'bg-primary/5', 'border-b-2', 'border-primary');
    document.getElementById('signupTab').classList.add('text-gray-400', 'border-gray-200');
}

function showSignup() {
    document.getElementById('loginForm').classList.add('hidden');
    document.getElementById('signupForm').classList.remove('hidden');
    document.getElementById('signupTab').classList.add('text-primary', 'bg-primary/5', 'border-b-2', 'border-primary');
    document.getElementById('signupTab').classList.remove('text-gray-400', 'border-gray-200');
    document.getElementById('loginTab').classList.remove('text-primary', 'bg-primary/5', 'border-b-2', 'border-primary');
    document.getElementById('loginTab').classList.add('text-gray-400', 'border-gray-200');
}

// ๋ฉ์์ง ํ์
function showMessage(elementId, message, isError = false) {
    const messageEl = document.getElementById(elementId);
    messageEl.textContent = message;
    messageEl.className = `mt-4 p-3 rounded-lg ${isError ? 'bg-red-50 text-red-700 border border-red-200' : 'bg-green-50 text-green-700 border border-green-200'}`;
    messageEl.classList.remove('hidden');
}

// ๋ก๊ทธ์ธ
async function handleLogin(event) {
    event.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    try {
        const { data, error } = await supabase.auth.signInWithPassword({
            email: email,
            password: password
        });
        
        if (error) throw error;
        
        showMessage('loginMessage', 'โ ๋ก๊ทธ์ธ ์ฑ๊ณต! ๋ฉ์ธ ํ์ด์ง๋ก ์ด๋ํฉ๋๋ค...', false);
        
        // ์ฌ์ฉ์ ์ด๋ฆ ์์ฅ
        localStorage.setItem('userName', data.user.user_metadata.name || '๊ณ๊ฐ');
        
        setTimeout(() => {
            window.location.href = 'flower.html';
        }, 1500);
        
    } catch (error) {
        console.error('๋ก๊ทธ์ธ ์๋ฌ:', error);
        showMessage('loginMessage', `โ ${error.message}`, true);
    }
}

// ํ์๊ฐ์
async function handleSignup(event) {
    event.preventDefault();
    
    const name = document.getElementById('signupName').value;
    const email = document.getElementById('signupEmail').value;
    const phone = document.getElementById('signupPhone').value;
    const password = document.getElementById('signupPassword').value;
    const passwordConfirm = document.getElementById('signupPasswordConfirm').value;
    
    // ๋น๋ฐ๋ฒํธ ํ์ธ
    if (password !== passwordConfirm) {
        showMessage('signupMessage', 'โ ๋น๋ฐ๋ฒํธ๊ฐ ์ผ์นํ์ง ์์ต๋๋ค.', true);
        return;
    }
    
    try {
        const { data, error } = await supabase.auth.signUp({
            email: email,
            password: password,
            options: {
                data: {
                    name: name,
                    phone: phone
                }
            }
        });
        
        if (error) throw error;
        
        showMessage('signupMessage', 'โ ํ์๊ฐ์ ์ฑ๊ณต! ์ด๋ฉ์ผ์ ํ์ธํด์ฃผ์ธ์. (ํ์ธ ํ ๋ก๊ทธ์ธ ๊ฐ๋ฅ)', false);
        
        // 3์ด ํ ๋ก๊ทธ์ธ ํญ์ผ๋ก ์ํ
        setTimeout(() => {
            showLogin();
        }, 3000);
        
    } catch (error) {
        console.error('ํ์๊ฐ์ ์๋ฌ:', error);
        showMessage('signupMessage', `โ ${error.message}`, true);
    }
}

// ๋ก๊ทธ์ธ ์ํ ํ์ธ
supabase.auth.onAuthStateChange((event, session) => {
    if (event === 'SIGNED_IN' && session) {
        console.log('โ ๋ก๊ทธ์ธ๋จ:', session.user.email);
    }
});
</script>
</body>
</html>
