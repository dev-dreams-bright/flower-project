<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>ë¡œê·¸ì¸ | ê½ƒë³´ë¼ê°€ë“ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#2d5f3f"
                    }
                },
            },
        }
    </script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
    </style>
</head>
<body class="bg-gray-50">
<!-- í—¤ë” -->
<header class="bg-white border-b">
<div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
<div class="flex items-center gap-3">
<span class="text-2xl">ğŸŒ¸</span>
<h2 class="text-2xl font-bold text-primary"><a href="flower.html">ê½ƒë³´ë¼ê°€ë“ </a></h2>
</div>
<a href="flower.html" class="text-sm text-gray-600 hover:text-primary">â† ë©”ì¸ìœ¼ë¡œ</a>
</div>
</header>

<main class="min-h-screen flex items-center justify-center py-12 px-4">
<div class="max-w-md w-full">
<!-- íƒ­ -->
<div class="bg-white rounded-t-2xl shadow-lg border-t border-x overflow-hidden">
<div class="flex">
<button id="loginTab" onclick="showLogin()" class="flex-1 py-4 font-bold text-primary bg-primary/5 border-b-2 border-primary transition-all">
ë¡œê·¸ì¸
</button>
<button id="signupTab" onclick="showSignup()" class="flex-1 py-4 font-bold text-gray-400 hover:text-gray-600 border-b border-gray-200 transition-all">
íšŒì›ê°€ì…
</button>
</div>
</div>

<!-- ë¡œê·¸ì¸ í¼ -->
<div id="loginForm" class="bg-white rounded-b-2xl shadow-lg border-b border-x p-8">
<h2 class="text-2xl font-bold mb-6 text-center">ê½ƒë³´ë¼ê°€ë“ ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤ ğŸŒ¸</h2>

<form onsubmit="handleLogin(event)" class="space-y-4">
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">ì´ë©”ì¼</label>
<input 
    type="email" 
    id="loginEmail" 
    required 
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="your@email.com"
/>
</div>

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸</label>
<input 
    type="password" 
    id="loginPassword" 
    required 
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
/>
</div>

<button 
    type="submit" 
    class="w-full py-4 bg-primary text-white font-bold rounded-xl hover:bg-primary/90 transition-all shadow-lg hover:shadow-xl mt-6"
>
ë¡œê·¸ì¸í•˜ê¸°
</button>
</form>

<div id="loginMessage" class="mt-4 p-3 rounded-lg hidden"></div>
</div>

<!-- íšŒì›ê°€ì… í¼ -->
<div id="signupForm" class="bg-white rounded-b-2xl shadow-lg border-b border-x p-8 hidden">
<h2 class="text-2xl font-bold mb-6 text-center">ìƒˆë¡œìš´ ì‹œì‘ ğŸŒ±</h2>

<form onsubmit="handleSignup(event)" class="space-y-4">
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">ì´ë¦„</label>
<input 
    type="text" 
    id="signupName" 
    required 
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="í™ê¸¸ë™"
/>
</div>

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">ì´ë©”ì¼</label>
<input 
    type="email" 
    id="signupEmail" 
    required 
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="your@email.com"
/>
</div>

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">ì „í™”ë²ˆí˜¸</label>
<input 
    type="text" 
    id="signupPhone" 
    required 
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="010-1234-5678 (ì„ íƒ)"
/>
</div>

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸</label>
<input 
    type="password" 
    id="signupPassword" 
    required 
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
/>
</div>

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
<input 
    type="password" 
    id="signupPasswordConfirm" 
    required 
    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary"
    placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥"
/>
</div>

<button 
    type="submit" 
    class="w-full py-4 bg-primary text-white font-bold rounded-xl hover:bg-primary/90 transition-all shadow-lg hover:shadow-xl mt-6"
>
íšŒì›ê°€ì…í•˜ê¸°
</button>
</form>

<div id="signupMessage" class="mt-4 p-3 rounded-lg hidden"></div>
</div>

<!-- í…ŒìŠ¤íŠ¸ ê³„ì • ì•ˆë‚´ -->
<div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-xl">
<p class="text-sm text-blue-800 text-center">
<span class="font-bold">ğŸ’¡ ê°„í¸ ê°€ì…:</span> ì–´ë–¤ ë¹„ë°€ë²ˆí˜¸ë“  OK! ì´ë©”ì¼ í™•ì¸ë§Œ í•˜ë©´ ì™„ë£Œ!
</p>
</div>
</div>
</main>

<!-- Supabase Client -->
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

// Supabase ì´ˆê¸°í™”
const SUPABASE_URL = 'https://xebqrsnkimtdlrjylvgy.supabase.co';
const SUPABASE_ANON_KEY = 'sb_publishable_hAxbFj3PjkdVeYqDssDsDQ_aoND-4FU';
window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
console.log('âœ… Supabase ì—°ê²° ì™„ë£Œ!');
</script>

<script>
// íƒ­ ì „í™˜
function showLogin() {
    document.getElementById('loginForm').classList.remove('hidden');
    document.getElementById('signupForm').classList.add('hidden');
    document.getElementById('loginTab').classList.add('text-primary', 'bg-primary/5', 'border-b-2', 'border-primary');
    document.getElementById('loginTab').classList.remove('text-gray-400', 'border-gray-200');
    document.getElementById('signupTab').classList.remove('text-primary', 'bg-primary/5', 'border-b-2', 'border-primary');
    document.getElementById('signupTab').classList.add('text-gray-400', 'border-gray-200');
}

function showSignup() {
    document.getElementById('loginForm').classList.add('hidden');
    document.getElementById('signupForm').classList.remove('hidden');
    document.getElementById('signupTab').classList.add('text-primary', 'bg-primary/5', 'border-b-2', 'border-primary');
    document.getElementById('signupTab').classList.remove('text-gray-400', 'border-gray-200');
    document.getElementById('loginTab').classList.remove('text-primary', 'bg-primary/5', 'border-b-2', 'border-primary');
    document.getElementById('loginTab').classList.add('text-gray-400', 'border-gray-200');
}

// ë©”ì‹œì§€ í‘œì‹œ
function showMessage(elementId, message, isError = false) {
    const messageEl = document.getElementById(elementId);
    messageEl.textContent = message;
    messageEl.className = `mt-4 p-3 rounded-lg ${isError ? 'bg-red-50 text-red-700 border border-red-200' : 'bg-green-50 text-green-700 border border-green-200'}`;
    messageEl.classList.remove('hidden');
}

// ë¡œê·¸ì¸
async function handleLogin(event) {
    event.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    try {
        const { data, error } = await supabase.auth.signInWithPassword({
            email: email,
            password: password
        });
        
        if (error) throw error;
        
        showMessage('loginMessage', 'âœ… ë¡œê·¸ì¸ ì„±ê³µ! ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...', false);
        
        // ì‚¬ìš©ì ì´ë¦„ ì €ì¥
        localStorage.setItem('userName', data.user.user_metadata.name || 'ê³ ê°');
        
        setTimeout(() => {
            window.location.href = 'flower.html';
        }, 1500);
        
    } catch (error) {
        console.error('ë¡œê·¸ì¸ ì—ëŸ¬:', error);
        showMessage('loginMessage', `âŒ ${error.message}`, true);
    }
}

// íšŒì›ê°€ì…
async function handleSignup(event) {
    event.preventDefault();
    
    const name = document.getElementById('signupName').value;
    const email = document.getElementById('signupEmail').value;
    const phone = document.getElementById('signupPhone').value;
    const password = document.getElementById('signupPassword').value;
    const passwordConfirm = document.getElementById('signupPasswordConfirm').value;
    
    // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
    if (password !== passwordConfirm) {
        showMessage('signupMessage', 'âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', true);
        return;
    }
    
    try {
        const { data, error } = await supabase.auth.signUp({
            email: email,
            password: password,
            options: {
                data: {
                    name: name,
                    phone: phone
                }
            }
        });
        
        if (error) throw error;
        
        showMessage('signupMessage', 'âœ… íšŒì›ê°€ì… ì„±ê³µ! ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”. (í™•ì¸ í›„ ë¡œê·¸ì¸ ê°€ëŠ¥)', false);
        
        // 3ì´ˆ í›„ ë¡œê·¸ì¸ íƒ­ìœ¼ë¡œ ì „í™˜
        setTimeout(() => {
            showLogin();
        }, 3000);
        
    } catch (error) {
        console.error('íšŒì›ê°€ì… ì—ëŸ¬:', error);
        showMessage('signupMessage', `âŒ ${error.message}`, true);
    }
}

// ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
supabase.auth.onAuthStateChange((event, session) => {
    if (event === 'SIGNED_IN' && session) {
        console.log('âœ… ë¡œê·¸ì¸ë¨:', session.user.email);
    }
});
</script>
</body>
</html>
